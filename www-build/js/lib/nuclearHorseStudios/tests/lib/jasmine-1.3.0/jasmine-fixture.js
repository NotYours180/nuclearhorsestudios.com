define(["jquery"],function($){var createHTMLBlock;!function($){console.log($);var jasmineFixture,originalAffix,originalInject,originalJasmineFixture,root,_;return root=this,originalJasmineFixture=root.jasmineFixture,originalInject=root.inject,originalAffix=root.affix,_=function(list){return{inject:function(iterator,memo){var item,_i,_len,_results;for(_results=[],_i=0,_len=list.length;_len>_i;_i++)item=list[_i],_results.push(memo=iterator(memo,item));return _results}}},root.jasmineFixture=function($){var $whatsTheRootOf,applyAttributes,defaultConfiguration,defaults,init,injectContents,isReady,isString,itLooksLikeHtml,rootId,tidyUp;return $.fn.affix=root.affix=function(selectorOptions){var $top;return $top=null,_(selectorOptions.split(/[ ](?=[^\]]*?(?:\[|$))/)).inject(function($parent,elementSelector){var $el;return">"===elementSelector?$parent:($el=createHTMLBlock($,elementSelector).appendTo($parent),$top||($top=$el),$el)},$whatsTheRootOf(this)),$top},$whatsTheRootOf=function(that){return null!=that.jquery?that:$("#jasmine_content").length>0?$("#jasmine_content"):$('<div id="jasmine_content"></div>').appendTo("body")},afterEach(function(){return $("#jasmine_content").remove()}),isReady=!1,rootId="specContainer",defaultConfiguration={el:"div",cssClass:"",id:"",text:"",html:"",defaultAttribute:"class",attrs:{}},defaults=$.extend({},defaultConfiguration),$.jasmine={inject:function(arg,context){var $toInject,config,parent;return isReady!==!0&&init(),parent=context?context:$("#"+rootId),$toInject=void 0,itLooksLikeHtml(arg)?$toInject=$(arg):(config=$.extend({},defaults,arg,{userString:arg}),$toInject=$("<"+config.el+"></"+config.el+">"),applyAttributes($toInject,config),injectContents($toInject,config)),$toInject.appendTo(parent)},configure:function(config){return $.extend(defaults,config)},restoreDefaults:function(){return defaults=$.extend({},defaultConfiguration)},noConflict:function(){return root.jasmineFixture=originalJasmineFixture,root.inject=originalInject,root.affix=originalAffix,this}},$.fn.inject=function(html){return $.jasmine.inject(html,$(this))},applyAttributes=function($html,config){var attrs,key,_results;attrs=$.extend({},{id:config.id,"class":config["class"]||config.cssClass},config.attrs),isString(config.userString)&&(attrs[config.defaultAttribute]=config.userString),_results=[];for(key in attrs)attrs[key]?_results.push($html.attr(key,attrs[key])):_results.push(void 0);return _results},injectContents=function($el,config){if(config.text&&config.html)throw"Error: because they conflict, you may only configure inject() to set `html` or `text`, not both! \n\nHTML was: "+config.html+" \n\n Text was: "+config.text;return config.text?$el.text(config.text):config.html?$el.html(config.html):void 0},itLooksLikeHtml=function(arg){return isString(arg)&&-1!==arg.indexOf("<")},isString=function(arg){return arg&&arg.constructor===String},init=function(){return $("body").append('<div id="'+rootId+'"></div>'),isReady=!0},tidyUp=function(){return $("#"+rootId).remove(),isReady=!1},$(function(){return init()}),afterEach(function(){return tidyUp()}),$.jasmine},$?(jasmineFixture=root.jasmineFixture($),root.inject=root.inject||jasmineFixture.inject):void 0}($),createHTMLBlock=function(){var bindData,bindEvents,parseAttributes,parseClasses,parseContents,parseEnclosure,parseReferences,parseVariableScope,regAttr,regAttrDfn,regAttrs,regCBrace,regClass,regClasses,regData,regDatas,regEvent,regEvents,regExclamation,regId,regReference,regTag,regTagNotContent,regZenTagDfn;return createHTMLBlock=function($,ZenObject,data,functions,indexes){var ZenCode,arr,block,blockAttrs,blockClasses,blockHTML,blockId,blockTag,blocks,el,el2,els,forScope,indexName,inner,len,obj,origZenCode,paren,result,ret,zc,zo;if($.isPlainObject(ZenObject)?ZenCode=ZenObject.main:(ZenCode=ZenObject,ZenObject={main:ZenCode}),origZenCode=ZenCode,void 0===indexes&&(indexes={}),"!"===ZenCode.charAt(0)||$.isArray(data)){for($.isArray(data)?forScope=ZenCode:(obj=parseEnclosure(ZenCode,"!"),obj=obj.substring(obj.indexOf(":")+1,obj.length-1),forScope=parseVariableScope(ZenCode));"@"===forScope.charAt(0);)forScope=parseVariableScope("!for:!"+parseReferences(forScope,ZenObject));zo=ZenObject,zo.main=forScope,el=$(),"!for:"===ZenCode.substring(0,5)||$.isArray(data)?(!$.isArray(data)&&obj.indexOf(":")>0&&(indexName=obj.substring(0,obj.indexOf(":")),obj=obj.substr(obj.indexOf(":")+1)),arr=$.isArray(data)?data:data[obj],zc=zo.main,($.isArray(arr)||$.isPlainObject(arr))&&$.map(arr,function(value,index){var next;return zo.main=zc,void 0!==indexName&&(indexes[indexName]=index),$.isPlainObject(value)||(value={value:value}),next=createHTMLBlock($,zo,value,functions,indexes),0!==el.length?$.each(next,function(index,value){return el.push(value)}):void 0}),ZenCode=$.isArray(data)?"":ZenCode.substr(obj.length+6+forScope.length)):"!if:"===ZenCode.substring(0,4)&&(result=parseContents("!"+obj+"!",data,indexes),("undefined"!==result||"false"!==result||""!==result)&&(el=createHTMLBlock($,zo,data,functions,indexes)),ZenCode=ZenCode.substr(obj.length+5+forScope.length)),ZenObject.main=ZenCode}else if("("===ZenCode.charAt(0))paren=parseEnclosure(ZenCode,"(",")"),inner=paren.substring(1,paren.length-1),ZenCode=ZenCode.substr(paren.length),zo=ZenObject,zo.main=inner,el=createHTMLBlock($,zo,data,functions,indexes);else{if(blocks=ZenCode.match(regZenTagDfn),block=blocks[0],0===block.length)return"";if(block.indexOf("@")>=0)return ZenCode=parseReferences(ZenCode,ZenObject),zo=ZenObject,zo.main=ZenCode,createHTMLBlock($,zo,data,functions,indexes);block=parseContents(block,data,indexes),blockClasses=parseClasses($,block),regId.test(block)&&(blockId=regId.exec(block)[1]),blockAttrs=parseAttributes(block,data),blockTag="{"===block.charAt(0)?"span":"div","#"!==ZenCode.charAt(0)&&"."!==ZenCode.charAt(0)&&"{"!==ZenCode.charAt(0)&&(blockTag=regTag.exec(block)[1]),-1!==block.search(regCBrace)&&(blockHTML=block.match(regCBrace)[1]),blockAttrs=$.extend(blockAttrs,{id:blockId,"class":blockClasses,html:blockHTML}),el=$("<"+blockTag+">",blockAttrs),el.attr(blockAttrs),el=bindEvents(block,el,functions),el=bindData(block,el,data),ZenCode=ZenCode.substr(blocks[0].length),ZenObject.main=ZenCode}return ZenCode.length>0&&(">"===ZenCode.charAt(0)&&("("===ZenCode.charAt(1)?(zc=parseEnclosure(ZenCode.substr(1),"(",")"),ZenCode=ZenCode.substr(zc.length+1)):"!"===ZenCode.charAt(1)?(obj=parseEnclosure(ZenCode.substr(1),"!"),forScope=parseVariableScope(ZenCode.substr(1)),zc=obj+forScope,ZenCode=ZenCode.substr(zc.length+1)):(len=Math.max(ZenCode.indexOf("+"),ZenCode.length),zc=ZenCode.substring(1,len),ZenCode=ZenCode.substr(len)),zo=ZenObject,zo.main=zc,els=$(createHTMLBlock($,zo,data,functions,indexes)),els.appendTo(el)),"+"===ZenCode.charAt(0)&&(zo=ZenObject,zo.main=ZenCode.substr(1),el2=createHTMLBlock($,zo,data,functions,indexes),$.each(el2,function(index,value){return el.push(value)}))),ret=el},bindData=function(ZenCode,el,data){var datas,i,split;if(0===ZenCode.search(regDatas))return el;if(datas=ZenCode.match(regDatas),null===datas)return el;for(i=0;i<datas.length;)split=regData.exec(datas[i]),void 0===split[3]?$(el).data(split[1],data[split[1]]):$(el).data(split[1],data[split[3]]),i++;return el},bindEvents=function(ZenCode,el,functions){var bindings,fn,i,split;if(0===ZenCode.search(regEvents))return el;if(bindings=ZenCode.match(regEvents),null===bindings)return el;for(i=0;i<bindings.length;)split=regEvent.exec(bindings[i]),fn=void 0===split[2]?functions[split[1]]:functions[split[2]],$(el).bind(split[1],fn),i++;return el},parseAttributes=function(ZenBlock,data){var attrStrs,attrs,i,parts;if(-1===ZenBlock.search(regAttrDfn))return void 0;for(attrStrs=ZenBlock.match(regAttrDfn),attrs={},i=0;i<attrStrs.length;)parts=regAttr.exec(attrStrs[i]),attrs[parts[1]]="",void 0!==parts[3]&&(attrs[parts[1]]=parseContents(parts[3],data)),i++;return attrs},parseClasses=function($,ZenBlock){var classes,clsString,i;if(ZenBlock=ZenBlock.match(regTagNotContent)[0],-1===ZenBlock.search(regClasses))return void 0;for(classes=ZenBlock.match(regClasses),clsString="",i=0;i<classes.length;)clsString+=" "+regClass.exec(classes[i])[1],i++;return $.trim(clsString)},parseContents=function(ZenBlock,data,indexes){var html;if(void 0===indexes&&(indexes={}),html=ZenBlock,void 0===data)return html;for(;regExclamation.test(html);)html=html.replace(regExclamation,function(str){var begChar,fn,val;return begChar="",str.indexOf("!for:")>0||str.indexOf("!if:")>0?str:("!"!==str.charAt(0)&&(begChar=str.charAt(0),str=str.substring(2,str.length-1)),fn=new Function("data","indexes","var r=undefined;with(data){try{r="+str+";}catch(e){}}"+"with(indexes){try{if(r===undefined)r="+str+";}catch(e){}}"+"return r;"),val=unescape(fn(data,indexes)),begChar+val)});return html=html.replace(/\\./g,function(str){return str.charAt(1)}),unescape(html)},parseEnclosure=function(ZenCode,open,close,count){var index,ret;if(void 0===close&&(close=open),index=1,void 0===count&&(count=ZenCode.charAt(0)===open?1:0),0!==count){for(;count>0&&index<ZenCode.length;)ZenCode.charAt(index)===close&&"\\"!==ZenCode.charAt(index-1)?count--:ZenCode.charAt(index)===open&&"\\"!==ZenCode.charAt(index-1)&&count++,index++;return ret=ZenCode.substring(0,index)}},parseReferences=function(ZenCode,ZenObject){return ZenCode=ZenCode.replace(regReference,function(str){var fn;return str=str.substr(1),fn=new Function("objs",'var r="";with(objs){try{r='+str+";"+"}catch(e){}}"+"return r;"),fn(ZenObject,parseReferences)})},parseVariableScope=function(ZenCode){var forCode,rest,tag;return"!for:"!==ZenCode.substring(0,5)&&"!if:"!==ZenCode.substring(0,4)?void 0:(forCode=parseEnclosure(ZenCode,"!"),ZenCode=ZenCode.substr(forCode.length),"("===ZenCode.charAt(0)?parseEnclosure(ZenCode,"(",")"):(tag=ZenCode.match(regZenTagDfn)[0],ZenCode=ZenCode.substr(tag.length),0===ZenCode.length||"+"===ZenCode.charAt(0)?tag:">"===ZenCode.charAt(0)?(rest="",rest=parseEnclosure(ZenCode.substr(1),"(",")",1),tag+">"+rest):void 0))},regZenTagDfn=/([#\.\@]?[\w-]+|\[([\w-!?=:"']+(="([^"]|\\")+")? {0,})+\]|\~[\w$]+=[\w$]+|&[\w$]+(=[\w$]+)?|[#\.\@]?!([^!]|\\!)+!){0,}(\{([^\}]|\\\})+\})?/i,regTag=/(\w+)/i,regId=/#([\w-!]+)/i,regTagNotContent=/((([#\.]?[\w-]+)?(\[([\w!]+(="([^"]|\\")+")? {0,})+\])?)+)/i,regClasses=/(\.[\w-]+)/g,regClass=/\.([\w-]+)/i,regReference=/(@[\w$_][\w$_\d]+)/i,regAttrDfn=/(\[([\w-!]+(="?([^"]|\\")+"?)? {0,})+\])/gi,regAttrs=/([\w-!]+(="([^"]|\\")+")?)/g,regAttr=/([\w-!]+)(="?(([^"\]]|\\")+)"?)?/i,regCBrace=/\{(([^\}]|\\\})+)\}/i,regExclamation=/(?:([^\\]|^))!([^!]|\\!)+!/g,regEvents=/\~[\w$]+(=[\w$]+)?/g,regEvent=/\~([\w$]+)=([\w$]+)/i,regDatas=/&[\w$]+(=[\w$]+)?/g,regData=/&([\w$]+)(=([\w$]+))?/i,createHTMLBlock}()});